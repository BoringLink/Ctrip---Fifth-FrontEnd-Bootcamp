generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  hotels    Hotel[]
}

model Hotel {
  id                String                   @id @default(cuid())
  nameZh            String                   @map("name_zh")
  nameEn            String                   @map("name_en")
  address           String
  starRating        Int                      @map("star_rating")
  openingDate       DateTime                 @map("opening_date")
  description       String?
  status            HotelStatus
  rejectionReason   String?                  @map("rejection_reason")
  merchantId        String                   @map("merchant_id")
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  location          Unsupported("geometry")? @map("location")
  facilities        HotelFacility[]
  images            HotelImage[]
  nearbyAttractions HotelNearbyAttraction[]
  promotions        HotelPromotion[]
  rooms             HotelRoom[]
  tags              HotelTagRelation[]
  merchant          User                     @relation(fields: [merchantId], references: [id])
  reservations      Reservation[]

  @@map("hotels")
}

model HotelRoom {
  id           String        @id @default(cuid())
  hotelId      String        @map("hotel_id")
  name         String
  description  String?
  price        Decimal       @db.Decimal(10, 2)
  capacity     Int
  quantity     Int
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  hotel        Hotel         @relation(fields: [hotelId], references: [id])
  reservations Reservation[]

  @@map("hotel_rooms")
}

model HotelFacility {
  id          String   @id @default(cuid())
  hotelId     String   @map("hotel_id")
  name        String
  description String?
  createdAt   DateTime @default(now())
  hotel       Hotel    @relation(fields: [hotelId], references: [id])

  @@map("hotel_facilities")
}

model HotelImage {
  id          String   @id @default(cuid())
  hotelId     String   @map("hotel_id")
  url         String
  description String?
  isMain      Boolean  @default(false) @map("is_main")
  createdAt   DateTime @default(now())
  hotel       Hotel    @relation(fields: [hotelId], references: [id])

  @@map("hotel_images")
}

model HotelPromotion {
  id            String       @id @default(cuid())
  hotelId       String       @map("hotel_id")
  name          String
  description   String?
  discountType  DiscountType @map("discount_type")
  discountValue Decimal      @map("discount_value") @db.Decimal(10, 2)
  startDate     DateTime     @map("start_date")
  endDate       DateTime     @map("end_date")
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  hotel         Hotel        @relation(fields: [hotelId], references: [id])

  @@map("hotel_promotions")
}

model HotelNearbyAttraction {
  id        String         @id @default(cuid())
  hotelId   String         @map("hotel_id")
  name      String
  type      AttractionType
  distance  String?
  createdAt DateTime       @default(now())
  hotel     Hotel          @relation(fields: [hotelId], references: [id])

  @@map("hotel_nearby_attractions")
}

model HotelTag {
  id          String             @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime           @default(now())
  hotels      HotelTagRelation[]

  @@map("hotel_tags")
}

model HotelTagRelation {
  id        String   @id @default(cuid())
  hotelId   String   @map("hotel_id")
  tagId     String   @map("tag_id")
  createdAt DateTime @default(now())
  hotel     Hotel    @relation(fields: [hotelId], references: [id])
  tag       HotelTag @relation(fields: [tagId], references: [id])

  @@map("hotel_tag_relations")
}

model Reservation {
  id           String             @id @default(cuid())
  hotelId      String             @map("hotel_id")
  roomId       String             @map("room_id")
  checkInDate  DateTime           @map("check_in_date")
  checkOutDate DateTime           @map("check_out_date")
  guestName    String             @map("guest_name")
  guestPhone   String             @map("guest_phone")
  guestEmail   String             @map("guest_email")
  status       ReservationStatus
  totalPrice   Decimal            @map("total_price") @db.Decimal(10, 2)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  guests       ReservationGuest[]
  hotel        Hotel              @relation(fields: [hotelId], references: [id])
  room         HotelRoom          @relation(fields: [roomId], references: [id])

  @@map("reservations")
}

model Guest {
  id           String             @id @default(cuid())
  name         String
  idType       IdType             @map("id_type")
  idNumber     String             @map("id_number")
  phone        String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  reservations ReservationGuest[]

  @@map("guests")
}

model ReservationGuest {
  id            String      @id @default(cuid())
  reservationId String      @map("reservation_id")
  guestId       String      @map("guest_id")
  createdAt     DateTime    @default(now())
  guest         Guest       @relation(fields: [guestId], references: [id])
  reservation   Reservation @relation(fields: [reservationId], references: [id])

  @@map("reservation_guests")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

enum UserRole {
  merchant
  admin
}

enum HotelStatus {
  pending
  approved
  rejected
  offline
}

enum DiscountType {
  percentage
  fixed
  package
}

enum AttractionType {
  attraction
  transportation
  shopping
}

enum ReservationStatus {
  confirmed
  check_in
  check_out
  cancelled
}

enum IdType {
  id_card
  passport
  other
}
