// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 用户角色枚举
enum UserRole {
  merchant
  admin
}

// 酒店状态枚举
enum HotelStatus {
  pending
  approved
  rejected
  offline
}

// 优惠类型枚举
enum DiscountType {
  percentage
  fixed
  package
}

// 景点类型枚举
enum AttractionType {
  attraction
  transportation
  shopping
}

// 预订状态枚举
enum ReservationStatus {
  confirmed
  check_in
  check_out
  cancelled
}

// 证件类型枚举
enum IdType {
  id_card
  passport
  other
}

// 用户表
model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  name      String
  role      UserRole
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // 关系
  hotels Hotel[]
}

// 酒店表
model Hotel {
  id              String       @id @default(cuid())
  nameZh          String       @map("name_zh")
  nameEn          String       @map("name_en")
  address         String
  starRating      Int          @map("star_rating")
  openingDate     DateTime     @map("opening_date")
  description     String?
  status          HotelStatus
  rejectionReason String?      @map("rejection_reason")
  merchantId      String       @map("merchant_id")
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // 关系
  merchant       User             @relation(fields: [merchantId], references: [id])
  rooms          HotelRoom[]
  facilities     HotelFacility[]
  images         HotelImage[]
  promotions     HotelPromotion[]
  nearbyAttractions HotelNearbyAttraction[]
  tags           HotelTagRelation[]
  reservations   Reservation[]

  @@map("hotels")
}

// 酒店房型表
model HotelRoom {
  id          String    @id @default(cuid())
  hotelId     String    @map("hotel_id")
  name        String
  description String?
  price       Decimal   @db.Decimal(10, 2)
  capacity    Int
  quantity    Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // 关系
  hotel      Hotel         @relation(fields: [hotelId], references: [id])
  reservations Reservation[]

  @@map("hotel_rooms")
}

// 酒店设施表
model HotelFacility {
  id          String    @id @default(cuid())
  hotelId     String    @map("hotel_id")
  name        String
  description String?
  createdAt   DateTime  @default(now())

  // 关系
  hotel       Hotel     @relation(fields: [hotelId], references: [id])

  @@map("hotel_facilities")
}

// 酒店图片表
model HotelImage {
  id          String    @id @default(cuid())
  hotelId     String    @map("hotel_id")
  url         String
  description String?
  isMain      Boolean   @default(false) @map("is_main")
  createdAt   DateTime  @default(now())

  // 关系
  hotel       Hotel     @relation(fields: [hotelId], references: [id])

  @@map("hotel_images")
}

// 酒店优惠表
model HotelPromotion {
  id            String      @id @default(cuid())
  hotelId       String      @map("hotel_id")
  name          String
  description   String?
  discountType  DiscountType @map("discount_type")
  discountValue Decimal     @db.Decimal(10, 2) @map("discount_value")
  startDate     DateTime    @map("start_date")
  endDate       DateTime    @map("end_date")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // 关系
  hotel         Hotel       @relation(fields: [hotelId], references: [id])

  @@map("hotel_promotions")
}

// 酒店附近景点表
model HotelNearbyAttraction {
  id          String         @id @default(cuid())
  hotelId     String         @map("hotel_id")
  name        String
  type        AttractionType
  distance    String?
  createdAt   DateTime       @default(now())

  // 关系
  hotel       Hotel          @relation(fields: [hotelId], references: [id])

  @@map("hotel_nearby_attractions")
}

// 酒店标签表
model HotelTag {
  id          String    @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime  @default(now())

  // 关系
  hotels      HotelTagRelation[]

  @@map("hotel_tags")
}

// 酒店-标签关联表
model HotelTagRelation {
  id        String    @id @default(cuid())
  hotelId   String    @map("hotel_id")
  tagId     String    @map("tag_id")
  createdAt DateTime  @default(now())

  // 关系
  hotel     Hotel     @relation(fields: [hotelId], references: [id])
  tag       HotelTag  @relation(fields: [tagId], references: [id])

  @@map("hotel_tag_relations")
}

// 预订表
model Reservation {
  id           String             @id @default(cuid())
  hotelId      String             @map("hotel_id")
  roomId       String             @map("room_id")
  checkInDate  DateTime           @map("check_in_date")
  checkOutDate DateTime           @map("check_out_date")
  guestName    String             @map("guest_name")
  guestPhone   String             @map("guest_phone")
  guestEmail   String             @map("guest_email")
  status       ReservationStatus
  totalPrice   Decimal            @db.Decimal(10, 2) @map("total_price")
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  // 关系
  hotel        Hotel              @relation(fields: [hotelId], references: [id])
  room         HotelRoom          @relation(fields: [roomId], references: [id])
  guests       ReservationGuest[]

  @@map("reservations")
}

// 入住人员表
model Guest {
  id        String    @id @default(cuid())
  name      String
  idType    IdType    @map("id_type")
  idNumber  String    @map("id_number")
  phone     String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // 关系
  reservations ReservationGuest[]

  @@map("guests")
}

// 预订-入住人员关联表
model ReservationGuest {
  id            String    @id @default(cuid())
  reservationId String    @map("reservation_id")
  guestId       String    @map("guest_id")
  createdAt     DateTime  @default(now())

  // 关系
  reservation   Reservation @relation(fields: [reservationId], references: [id])
  guest         Guest       @relation(fields: [guestId], references: [id])

  @@map("reservation_guests")
}
